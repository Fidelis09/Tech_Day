<div class="financeiro-container">
    <h2>üí∞ Painel Financeiro</h2>

    <!-- ======== FILTRO DE M√äS/ANO ======== -->
    <form method="get" action="/financeiro" class="filtro-financeiro">
        <label for="mes">M√™s:</label>
        <select name="mes" id="mes">
            {% set meses_nome = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'] %}
            {% for i in range(1, 13) %}
                <option value="{{ i }}" {% if i == mes %}selected{% endif %}>{{ meses_nome[i-1] }}</option>
            {% endfor %}
        </select>

        <label for="ano">Ano:</label>
        <input type="number" name="ano" id="ano" value="{{ ano }}" min="2020" max="{{ datetime.date.today().year + 1 }}">

        <button type="submit">üîç Filtrar</button>
    </form>

    <!-- ======== BLOCOS DE RESUMO ======== -->
    <div class="cards-financeiro">
        <div class="card-fin lucro-bruto">
            <h3>Lucro Bruto</h3>
            <p>R$ {{ "{:,.2f}".format(lucro_bruto) }}</p>
            <small>Receitas totais de {{ meses_nome[mes-1] }}/{{ ano }}</small>
        </div>

        <div class="card-fin lucro-liquido">
            <h3>Lucro L√≠quido</h3>
            <p>R$ {{ "{:,.2f}".format(lucro_liquido) }}</p>
            <small>Lucro ap√≥s custos com monitores</small>
        </div>

        <div class="card-fin despesas">
            <h3>Gastos com Monitores</h3>
            <p>R$ {{ "{:,.2f}".format(gastos_monitores) }}</p>
            <small>Total pago a monitores neste m√™s</small>
        </div>

        <div class="card-fin receita-futura">
            <h3>Previs√£o de Receita Futura</h3>
            <p>R$ {{ "{:,.2f}".format(receitas_futuras) }}</p>
            <small>Baseada em festas j√° agendadas</small>
        </div>
    </div>

    <!-- ======== GR√ÅFICO DE LUCROS MENSAIS ======== -->
    <div class="grafico-container">
        <h3>üìà Lucros Mensais - {{ ano }}</h3>
        <canvas id="graficoLucro"></canvas>
    </div>
</div>

<!-- ======== ESTILOS ======== -->
<style>
.financeiro-container {
    padding: 20px;
}
.filtro-financeiro {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    background: #fff;
    padding: 12px 16px;
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    margin-bottom: 25px;
}
.filtro-financeiro select,
.filtro-financeiro input,
.filtro-financeiro button {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
}
.filtro-financeiro button {
    background: #2e8b57;
    color: white;
    cursor: pointer;
    transition: 0.2s;
}
.filtro-financeiro button:hover {
    background: #256f46;
}
.cards-financeiro {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}
.card-fin {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 20px;
    text-align: center;
}
.card-fin h3 {
    font-size: 1rem;
    color: #555;
}
.card-fin p {
    font-size: 1.4rem;
    font-weight: bold;
    color: #2e8b57;
}
.card-fin small {
    color: #888;
}
.grafico-container {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    padding: 20px;
    margin-bottom: 30px;
}
.lucro-bruto p { color: #1a73e8; }
.lucro-liquido p { color: #2e8b57; }
.despesas p { color: #d9534f; }
.receita-futura p { color: #f7b500; }
</style>

<!-- ======== CHART.JS ======== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const meses = JSON.parse('{{ meses | tojson | safe }}');
const lucros = JSON.parse('{{ lucros_mensais | tojson | safe }}');

new Chart(document.getElementById('graficoLucro'), {
    type: 'line',
    data: {
        labels: meses,
        datasets: [{
            label: 'Lucro Mensal (R$)',
            data: lucros,
            borderColor: '#2e8b57',
            backgroundColor: 'rgba(46,139,87,0.2)',
            fill: true,
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'bottom' },
            tooltip: { mode: 'index', intersect: false }
        }
    }
});
</script>
